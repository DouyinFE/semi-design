@use "sass:meta";
@use 'animation.scss';
@use 'variables.scss';
@use 'mixin.scss';
@use 'operationPanel.scss';


operationPanel.$module: #{$prefix}-table;

.#{operationPanel.$module} {
    width: 100%;
    text-align: left;
    border-collapse: separate;
    border-spacing: 0;
    font-size: inherit;
    display: table;

    &-wrapper {
        zoom: 1;
        position: relative;
        clear: both;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        @include font-size-regular;
        color: variables.$color-table-text-default;
        width: 100%;

        &[data-column-fixed='true'] {
            z-index: 1;
        }

        &-ltr {
            direction: ltr;

            .#{$prefix}-spin {
                direction: ltr;
            }
        }
    }

    &-middle {
        .#{operationPanel.$module}-tbody > .#{operationPanel.$module}-row > .#{operationPanel.$module}-row-cell {
            padding-top: variables.$spacing-table_middle-paddingY;
            padding-bottom: variables.$spacing-table_middle-paddingY;
        }
    }

    &-small {
        .#{operationPanel.$module}-tbody > .#{operationPanel.$module}-row > .#{operationPanel.$module}-row-cell {
            padding-top: variables.$spacing-table_small-paddingY;
            padding-bottom: variables.$spacing-table_small-paddingY;
        }
    }

    &-title {
        position: relative;
        padding-top: variables.$spacing-table_title-paddingY;
        padding-bottom: variables.$spacing-table_title-paddingY;
        padding-left: variables.$spacing-table_title-paddingX;
        padding-right: variables.$spacing-table_title-paddingX;
    }

    &-container {
        position: relative;
    }

    &-header {
        overflow: hidden;
        scrollbar-base-color: transparent;

        &::-webkit-scrollbar {
            background-color: transparent;
            border-bottom: variables.$width-table_header_border variables.$border-table_base-borderStyle variables.$color-table_th-border-default;
        }

        &-sticky {
            position: sticky;
            z-index: variables.$z-table_fixed_column + 1;

            .semi-table-thead > .semi-table-row > .semi-table-row-head {
                background-color: variables.$color-table-bg-default;
            }
        }

        &-hidden {
            height: 0;
        }
    }

    &-align-center {
        .#{operationPanel.$module}-operate-wrapper {
            justify-content: center;
        }
    }

    &-align-right {
        .#{operationPanel.$module}-operate-wrapper {
            justify-content: flex-end;
        }
    }

    &-operate-wrapper {
        display: flex;
        justify-content: flex-start;
    }

    &-body {
        overflow: auto;
        width: 100%;
        box-sizing: border-box;
    }

    &-colgroup {
        display: table-column-group;
        .#{operationPanel.$module}-col {
            display: table-column;
        }
        .#{operationPanel.$module}-column {
            &-expand,
            &-selection {
                width: variables.$width-table_column_selection;
            }
        }
    }

    &-thead {
        & > .#{operationPanel.$module}-row {
            & > .#{operationPanel.$module}-row-head {
                background-color: variables.$color-table_th-bg-default;
                color: variables.$color-table_th-text-default;
                font-weight: $font-weight-bold;
                text-align: left;
                border-bottom: variables.$width-table_header_border variables.$border-table_base-borderStyle variables.$color-table_th-border-default;
                padding-left: variables.$spacing-table_row_head-paddingX;
                padding-right: variables.$spacing-table_row_head-paddingX;
                padding-top: variables.$spacing-table_row_head-paddingY;
                padding-bottom: variables.$spacing-table_row_head-paddingY;
                vertical-align: middle;
                overflow-wrap: break-word;
                // word-break: break-all;
                // word-wrap: break-word;
                position: relative;
                transition: background-color animation.$transition_duration-table_row-head-bg animation.$transition_function-table_row-head-bg;

                &.#{operationPanel.$module}-row-head-clickSort {
                    cursor: pointer;
                    &:hover {
                        background-image: linear-gradient(0deg, variables.$color-table_th-clickSort-bg-hover, variables.$color-table_th-clickSort-bg-hover);
                        background-color: variables.$color-table_cell-bg-hover;
                        
                        // &.#{$module}-cell-fixed {
                        //     &-left,
                        //     &-right {
                        //         &::before {
                        //             background-color: transparent;
                        //         }
                        //     }
                        // }
                    }
                }

                &.#{operationPanel.$module}-cell-fixed {
                    &-left,
                    &-right {
                        z-index: variables.$z-table_fixed_column;
                        position: sticky;
                        background-color: variables.$color-table_th-bg-default;

                        // &::before {
                        //     background-color: $color-table_th-bg-default;
                        //     content: '';
                        //     position: absolute;
                        //     left: 0;
                        //     top: 0;
                        //     right: 0;
                        //     bottom: 0;
                        //     display: block;
                        //     z-index: -1;
                        // }
                    }

                    &-left-last {
                        border-right: variables.$width-table_cell_fixed_left_last solid variables.$color-table_shadow-border-default;
                        box-shadow: #{variables.$shadow-table_right};

                        &.resizing {
                            @include mixin.genResizing();
                        }
                    }

                    &-right-first {
                        border-left: variables.$width-table_cell_fixed_right_first solid variables.$color-table_shadow-border-default;
                        box-shadow: #{variables.$shadow-table_left};

                        &.resizing {
                            @include mixin.genResizing();
                        }

                        // scroll-bar 列无需有box-shadow

                        &[x-type='column-scrollbar'] {
                            box-shadow: none;
                            border-left: transparent;
                        }
                    }
                }

                &.#{operationPanel.$module}-column-selection {
                    text-align: center;
                }

                &[colspan]:not([colspan='1']) {
                    text-align: center;
                }

                .#{operationPanel.$module}-header-column {
                    display: inline-flex;
                    align-items: center;
                }

                &-ellipsis {
                    @include text-overflow-hidden;

                    .#{operationPanel.$module}-row-head-title {
                        @include text-overflow-hidden;
                    }
                }
            }

            .react-resizable {
                position: relative;
                background-clip: padding-box;
            }

            .resizing {
                @include mixin.genResizing();
            }

            .react-resizable-handle {
                position: absolute;
                width: variables.$width-table_react_resizable_handle;
                height: calc(100% - #{variables.$spacing-table_resizable-offset-y} * 2);
                background-color: variables.$color-table-border-default;
                bottom: variables.$spacing-table_resizable-bottom;
                right: variables.$spacing-table_react_resizable_handle-right;
                cursor: col-resize;
                z-index: 0;

                &:hover {
                    background-color: variables.$color-table_resizer-bg-default;
                }
            }
        }
    }

    &-tbody {
        display: table-row-group;
        & > .#{operationPanel.$module}-row {
            display: table-row;
            background-color: variables.$color-table_body-bg-default;

            &:hover {
                & > .#{operationPanel.$module}-row-cell {
                    // $color-table_body-bg-hover has transparency，will reveal the background color $color-table_body-bg-default\
                    // combine background-image and background-color to make the non-fixed column color does not show through the bottom color
                    background-image: linear-gradient(0deg, variables.$color-table_body-bg-hover, variables.$color-table_body-bg-hover);
                    background-color: variables.$color-table_cell-bg-hover;

                    &.#{operationPanel.$module}-cell-fixed {
                        &-left,
                        &-right {
                            background-image: linear-gradient(0deg, variables.$color-table_body-bg-hover, variables.$color-table_body-bg-hover);
                            background-color: variables.$color-table_body-bg-default;

                            // &::before {
                            //     background-color: $color-table_body-bg-hover;
                            //     content: '';
                            //     position: absolute;
                            //     left: 0;
                            //     top: 0;
                            //     right: 0;
                            //     bottom: 0;
                            //     display: block;
                            //     z-index: -1;
                            // }
                        }
                    }
                }
            }

            & > .#{operationPanel.$module}-row-cell {
                display: table-cell;
                overflow-wrap: break-word;
                // word-wrap: break-word;
                // word-break: break-all;
                border-left: none;
                border-right: none;
                border-bottom: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
                padding: variables.$spacing-table_tbody_rowCell-padding;
                box-sizing: border-box;
                position: relative;
                vertical-align: middle;

                &.resizing {
                    border-right: variables.$width-table_resizer_border solid variables.$color-table_resizer-bg-default;
                }

                &-ellipsis {
                    @include text-overflow-hidden;
                }
            }
            &.#{operationPanel.$module}-row {
                &-expand {
                    & > .#{operationPanel.$module}-row-cell {
                        background-color: variables.$color-table_row_expanded-bg-default;
                    }
                }
                &-hidden {
                    display: none;
                }
            }

            & > .#{operationPanel.$module}-cell-fixed {
                &-left,
                &-right {
                    z-index: variables.$z-table_fixed_column;
                    position: sticky;
                    background-color: variables.$color-table-bg-default;
                }

                &-left-last {
                    border-right: variables.$width-table_cell_fixed_left_last solid variables.$color-table_shadow-border-default;
                    box-shadow: #{variables.$shadow-table_right};
                }

                &-right-first {
                    border-left: variables.$width-table_cell_fixed_right_first solid variables.$color-table_shadow-border-default;
                    box-shadow: #{variables.$shadow-table_left};
                }

                & > * {
                    transition: background-color animation.$transition_duration-table_body-bg animation.$transition_function-table_body-bg
                        animation.$transition_delay-table_body-bg;
                }
            }

            & > * {
                transition: background-color animation.$transition_duration-table_body-bg animation.$transition_function-table_body-bg
                    animation.$transition_delay-table_body-bg;
            }
        }

        & > .#{operationPanel.$module}-row-section {
            display: table-row;

            & > .#{operationPanel.$module}-row-cell {
                background-color: variables.$color-table_selection-bg-default;
                border-bottom: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
            }

            & > .#{operationPanel.$module}-row-cell:not(.#{operationPanel.$module}-column-selection) {
                padding: variables.$spacing-table_tbody_rowSelection_rowCell_notSelection-paddingY variables.$spacing-table_tbody_rowSelection_rowCell_notSelection-paddingX;
            }

            .#{operationPanel.$module}-section-inner {
                display: inline-flex;
                align-items: center;
            }
        }
    }

    &-virtualized .#{operationPanel.$module}-tbody {
        display: block;
        & > .#{operationPanel.$module}-row {
            display: flex;
            & > .#{operationPanel.$module}-row-cell {
                word-wrap: unset;
                word-break: unset;
                white-space: nowrap;
                display: inline-flex;
                align-items: center;
                overflow: hidden;
            }

            &-section {
                & > .#{operationPanel.$module}-row-cell {
                    padding-top: variables.$spacing-table-paddingY;
                    padding-bottom: variables.$spacing-table-paddingY;
                    display: flex;
                }
            }

            &-expand {
                & > .#{operationPanel.$module}-row-cell {
                    padding: 0;
                    overflow: unset;
                }
            }
        }
    }

    &-footer {
        background-color: variables.$color-table_footer-bg-default;
        padding: variables.$spacing-table_footer-padding;
        margin: 0;
        position: relative;
    }

    .#{operationPanel.$module}-selection {
        &-wrap {
            // inline-flex vertical-align baseline 会导致父元素高度异常
            display: inline-flex;
            vertical-align: bottom;
        }

        &-disabled {
            cursor: not-allowed;

            & > .#{$prefix}-checkbox {
                pointer-events: none;
            }
        }
    }

    .#{operationPanel.$module}-column {
        &-hidden {
            display: none;
        }

        &-selection {
            text-align: center;
            // width: $width-table_column_selection;

            .#{$prefix}-checkbox-inner-display {
                .#{$prefix}-icon {
                    left: 0;
                    top: 0;
                }
            }
        }

        &-expand {
            .#{operationPanel.$module}-expand-icon {
                transform: translateY(2px);

                &:last-child {
                    margin-right: 0;
                }
            }
        }

        &-sorter {
            display: inline-block;
            width: variables.$width-table_column_sorter-icon;
            height: variables.$height-table_column_sorter-icon;
            vertical-align: middle;
            text-align: center;

            &-wrapper {
                display: flex;
                gap: variables.$spacing-table_column_sorter-marginLeft;
                align-items: center;
                cursor: pointer;
                overflow: hidden;
            }

            &-up,
            &-down {
                height: 0;
                display: block;
                color: variables.$color-table_sorter-text-default;

                &:hover .anticon {
                    color: variables.$color-table_sorter-text-hover;
                }

                svg {
                    width: variables.$width-table_column_sorter-icon;
                    height: variables.$height-table_column_sorter-icon;
                }

                &.on {
                    .#{$prefix}-icon-caretup,
                    .#{$prefix}-icon-caretdown {
                        color: variables.$color-table_sorter_on-text-default;
                    }
                }
            }
        }

        &-filter {
            margin-left: variables.$spacing-table_column_filter-marginLeft;
            display: inline-flex;
            cursor: pointer;
            color: variables.$color-table_filter-text-default;
            // vertical-align: middle;
            align-items: center;

            svg {
                width: variables.$width-table_column_filter-icon;
                height: variables.$height-table_column_filter-icon;
            }

            &.on {
                color: variables.$color-table_filter_on-text-default;
            }
        }
    }

    &-bordered {
        .#{operationPanel.$module}-title {
            padding-left: variables.$spacing-table_bordered_titler-paddingLeft;
            padding-right: variables.$spacing-table_bordered_titler-paddingRight;
            border-top: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
            border-right: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
            border-left: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
        }

        .#{operationPanel.$module}-container {
            border: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
            border-right: 0;
            border-bottom: 0;
        }

        .#{operationPanel.$module}-header {
            &::-webkit-scrollbar {
                border-right: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
            }
        }

        .#{operationPanel.$module}-footer {
            border-left: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
            border-right: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
            border-bottom: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
        }

        .#{operationPanel.$module}-thead > .#{operationPanel.$module}-row > .#{operationPanel.$module}-row-head {
            .react-resizable-handle {
                background-color: transparent;
            }
        }

        .#{operationPanel.$module}-thead > .#{operationPanel.$module}-row > .#{operationPanel.$module}-row-head,
        .#{operationPanel.$module}-tbody > .#{operationPanel.$module}-row > .#{operationPanel.$module}-row-cell {
            border-right: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
        }

        .#{operationPanel.$module}-placeholder {
            border-right: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
        }
    }

    &-placeholder {
        position: sticky;
        left: 0px;
        z-index: 1;
        padding: #{variables.$spacing-table-paddingY} #{variables.$spacing-table-paddingX};
        color: variables.$color-table_placeholder-text-default;
        font-size: #{variables.$font-table_base-fontSize};
        text-align: center;
        background: variables.$color-table_pl-bg-default;
        border-bottom: variables.$width-table_base_border variables.$border-table_base-borderStyle variables.$color-table-border-default;
    }

    &-fixed {
        table-layout: fixed;
        min-width: 100%;

        & > .#{operationPanel.$module}-tbody {
            & > .#{operationPanel.$module}-row-expand > .#{operationPanel.$module}-row-cell > .#{operationPanel.$module}-expand-inner,
            & > .#{operationPanel.$module}-row-section > .#{operationPanel.$module}-row-cell > .#{operationPanel.$module}-section-inner {
                position: sticky;
                overflow: auto;
                left: 0;
                margin-left: -(variables.$spacing-table_expand_row-paddingLeft);
                margin-right: -(variables.$spacing-table_expand_row-paddingRight);
                padding-left: variables.$spacing-table_expand_row-paddingLeft;
                padding-right: variables.$spacing-table_expand_row-paddingRight;
                height: 100%;
                display: flex;
                align-items: center;
            }
        }

        // when header is fixed, table should use `table-layout: fixed` to avoid align bug
        &-header {
            table {
                table-layout: fixed;
            }
        }
    }

    &-scroll {
        &-position {
            &-left {
                .#{operationPanel.$module}-tbody,
                .#{operationPanel.$module}-thead {
                    & > .#{operationPanel.$module}-row > .#{operationPanel.$module}-cell-fixed-left-last {
                        box-shadow: none;
                    }
                }
            }

            &-right {
                .#{operationPanel.$module}-tbody,
                .#{operationPanel.$module}-thead {
                    & > .#{operationPanel.$module}-row > .#{operationPanel.$module}-cell-fixed-right-first {
                        box-shadow: none;
                    }
                }
            }
        }
    }

    &-pagination-outer {
        color: variables.$color-table_page-text-default;
        min-height: variables.$height-table_pagination_outer_min;
    }
}

.#{operationPanel.$module}-expand-icon {
    color: variables.$color-table_expanded_icon-default;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    user-select: none;
    background: variables.$color-table_expanded-bg-default;
    position: relative;
    margin-right: variables.$spacing-table_expand_icon-marginRight;

    &-cell {
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .#{operationPanel.$module}-expandedIcon-show{
        transition: transform 150ms cubic-bezier(0.62, 0.05, 0.36, 0.95);
        transform: rotate(90deg);
    }

    .#{operationPanel.$module}-expandedIcon-hide{
        transition: transform 150ms cubic-bezier(0.62, 0.05, 0.36, 0.95);
        transform: rotate(0deg);
    }
}

.#{operationPanel.$module}-column-filter-dropdown {
    .#{$prefix}-dropdown-menu {
        max-height: variables.$height-table_column_filter_dropdown;
        overflow-y: auto;
    }
}

@include meta.load-css('rtl.scss');
